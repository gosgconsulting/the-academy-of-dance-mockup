class PgDmDesignSkillTailwindOptions extends PgDmDesignSkill{constructor(e,r){super("tailwind","Tailwind CSS options"),this.version=e,this.provider=r;var t=this;this.openDialog=async function(){var t=r.settings,a=pinegrow.getCurrentProject();t.jit&&"true"===t.jit&&(t.mode="jit"),t.external_source_url&&(t.external_source_url=a.getAbsoluteUrl(t.external_source_url)),t.external_config_url&&(t.external_config_url=a.getAbsoluteUrl(t.external_config_url));const d=4<=r.framework.twGetCurrentVersion();var i=t.mode;let l=3;isApp()&&(e=new PgExternalTailwindVersionDetector,l=await e.detect(!0)||0);var e={mode:{name:"Compiler",type:"select",value:t.mode,default_value:"jit",options:function(){var e=[{key:"jit",name:"Built-in JIT compiler (3.4.3)"},{key:"jit4",name:"Built-in JIT compiler (4.1.4)"},{key:"jit2",name:"Built-in JIT compiler (2.2.6)"},{key:"full",name:"Built-in non-JIT compiler (2.2.6)"}];return isApp()&&e.push({key:"external",name:"External build process"}),e},validate:function(){return null},helptext:`<p>Choose how to compile the Tailwind CSS stylesheet. Options are:</p>
<ul>
<li><b>Built-in JIT compiler</b> - Use built-in Tailwind compiler to generate optimized Tailwind CSS with just CSS rules that are used in the project.</li>
<li><b>Built-in full (non-JIT) compiler</b> - Use built-in Tailwind compiler to generate full Tailwind CSS stylesheet. Not recommended due to huge size.</li>
<li><b>External build process</b> - Use an external build process with <code>npm</code> or standalone executable. This option gives you the most flexibility and it lets you use whatever Tailwind version you need. This option is only available in the desktop Pinegrow version.</li>
</ul>`},custom_config:{name:"Custom configuration",type:"text",textarea:!0,show_if:"!mode==external",value:t.custom_config||"",placeholder:"{}",validate:function(e,t,i,o,s,n){return r.validateCustomConfig(i)},helptext:`Set custom Tailwind CSS configuration in JSON format. This is useful to customize theme properties that are not exposed in the Design panel, for example, screen sizes. Use the "Add config settings" button to add properties to the configuration.<br><br>This config is used for all designs of the project.`},add_setting:{type:"button",name:"Add config settings...",show_if:"!mode==external",func:function(e,c,h,t,i){function o(){const i=this;var e=this.key,t=this.value;try{if(d){h.custom_config=h.custom_config||"",h.custom_config.indexOf("@theme")<0&&(h.custom_config+=`
@theme {
}
`);const l=new PgTailwind4ConfigParser;l.parse(h.custom_config),this.variable?$.each(this.value,function(e,t){l.setThemeVariable(i.variable+e,t)}):this.append&&l.appendCode("\n"+this.append),c.closest(".pg-dialog-fields").find(".crsa-field-custom_config textarea").val(l.getString()).trigger("change"),pinegrow.showQuickMessage(`Setting for ${e} added to the config. Edit the config to modify it.`)}else for(var o,s=JSON.parse(h.custom_config||"{}"),n=e.split("."),r=s,a=0;a<n.length;a++)a!==n.length-1?(r[n[a]]||(r[n[a]]={}),r=r[n[a]]):r[n[a]]?pinegrow.showQuickError(`Value for ${e} is already set.`):(r[n[a]]=t,o=JSON.stringify(s,null,4),c.closest(".pg-dialog-fields").find(".crsa-field-custom_config textarea").val(o).trigger("change"),pinegrow.showQuickMessage(`Setting for ${e} added to the config. Edit the config to modify it.`))}catch(e){pinegrow.showQuickError("The config is not a valid Tailwind CSS config.")}}var s=[{key:"theme.extend.screens",label:"Screen sizes",variable:"--breakpoint-",value:{"3xl":"1800px"},helptext:"Add or override one or more screen sizes."},{key:"theme.extend.spacing",label:"Spacing",value:{128:"32rem",144:"36rem"},helptext:"Add or override one or more spacing values.",v4:!1},{key:"theme.extend.borderRadius",label:"Border radius",variable:"--radius-",value:{"4xl":"2rem"},helptext:"Add or override one or more border radius values."},{key:"theme.extend.inset",label:"Inset",value:{"3px":"3px"},helptext:"Add or override one or more inset values.",v4:!1},{key:"theme.extend.zIndex",label:"Z Index",value:{100:"100"},helptext:"Add or override one or more z-index values.",v4:!1},{key:"theme.extend.gridTemplateColumns",label:"Grid template columns",value:{16:"repeat(16, minmax(0, 1fr))",footer:"200px minmax(900px, 1fr) 100px"},helptext:"Add or override one or more grid template columns values.",v4:!1},{key:"theme.extend.gridTemplateRows",label:"Grid template rows",value:{16:"repeat(16, minmax(0, 1fr))",layout:"200px minmax(900px, 1fr) 100px"},helptext:"Add or override one or more grid template rows values.",v4:!1},{key:"theme.extend.fontSize",label:"Font size",value:{sm:["14px","20px"],"2xl":["1.5rem",{lineHeight:"2rem",letterSpacing:"-0.01em",fontWeight:"500"}],"3xl":["1.875rem",{lineHeight:"2.25rem",letterSpacing:"-0.02em",fontWeight:"700"}]},helptext:"Add or override one or more font size values.",v4:!1},{key:"theme.extend.fontSize",label:"Font size",variable:"--text-",value:{sm:"14px","2xl":"1.5rem"},helptext:"Add or override one or more font size values.",v4:!0},{key:"theme.extend.lineHeight",label:"Line height",variable:"--text-",value:{"sm--line":"calc(2 / 1.5)","2xl--line":"calc(2 / 1.3)"},helptext:"Add or override one or more line height values.",v4:!0},{key:"theme.extend.letterSpacing",label:"Letter spacing",value:{"super-wide":"1em"},helptext:"Add or override one or more letter spacing values.",v4:!1},{key:"theme.extend.spacing",label:"Spacing",variable:"--",value:{spacing:"0.2rem"},helptext:"Add or override one or more letter spacing values.",v4:!0}],s=[{type:"header",label:"Add settings to custom config"},{label:"Define",submenu:[{key:"theme.screens",variable:"--breakpoint-",label:"Screen sizes",value:{sm:"640px",md:"768px",lg:"1024px",xl:"1280px","2xl":"1536px"},helptext:"Define all screen sizes.",v4:!1},{key:"darkMode",append:`@custom-variant dark (&:where(.dark, .dark *));`,label:"Dark mode",value:"selector",helptext:"Set how dark mode is activated."}].filter(function(e){return(!0!==e.v4||d)&&!(!1===e.v4&&d||(e.action=o,0))})},{label:"Extend",submenu:s=s.filter(function(e){return(!0!==e.v4||d)&&!(!1===e.v4&&d||(e.action=o,0))})}];return i.stopImmediatePropagation(),i.stopPropagation(),new CrsaContextMenu(s,c).showForElement(c),!1},helptext:"Add settings to the custom configuration."},custom_source_url:{name:"CSS file with additional rules",type:"text",value:t.custom_source_url,file_picker_use_project_as_parent:!0,file_picker:!0,file_picker_no_proxy:!0,show_if:"!mode==external",validate:function(e,t,i,o,s,n){if(i&&!a.hasContentForUrl(i))return"The file does not exist."},helptext:`<p>Select a CSS file that contains any additional CSS rules and Tailwind CSS declarations (such as @layer directives) that you wish to include into the stylesheet.<br>Note - this file should not be included on pages directly. Instead, it is fed into the built-in Tailwind CSS compiler to produce CSS rules in the compiled Tailwind theme.</p>`},disable_preflight:{name:"Disable preflight",type:"checkbox",value:"1",default_value:t.disable_preflight,negvalue:"0",show_if:"!mode==external",helptext:`<p>Preflight is a collection of CSS rules that reset all default browser styling. Check this to disable it.</p>`},external_config_url:{name:"Config file",type:"text",value:t.external_config_url,file_picker_use_project_as_parent:!0,file_picker:!0,file_picker_no_proxy:!0,show_if:function(e){return"external"===e?.mode&&l<4},validate:function(e,t,i,o,s,n){var r;if("external"===n.mode&&l<4)return i?(r=a.getAbsoluteUrl(i),crsaIsFileExist(crsaMakeFileFromUrl(r))?void 0:"The file does not exist."):"Tailwind CSS config file is required."},helptext:`<p>Select the file that contains Tailwind CSS configuration. This file is usually named <code>tailwind.config.js</code>.</p>`},external_source_url:{name:"Source CSS file",type:"text",value:t.external_source_url,file_picker_use_project_as_parent:!0,file_picker:!0,file_picker_no_proxy:!0,show_if:"mode==external",validate:function(e,t,i,o,s,n){var r;if("external"===n.mode)return i?(r=a.getAbsoluteUrl(i),crsaIsFileExist(crsaMakeFileFromUrl(r))?void 0:"The file does not exist."):"Source CSS file is required."},helptext:`<p>Select the source css file of your external build process. That is usually the css files that contains statements:</p>
<pre>
${l<4?`@tailwind base;
@tailwind components;
@tailwind utilities;`:`@import "tailwindcss" theme(static);`}
</pre>`},external_help:{name:"Learn more about using external build",type:"button",show_if:"mode==external",func:function(){pinegrow.openExternalUrl("https://pinegrow.com/docs/tailwind/using-external-build-process/")}}};4<=l&&delete e.external_config_url,pinegrow.showQuickDialog("Tailwind CSS Options",`Options`,`<p>Decide how to compile the Tailwind CSS stylesheet.</p><p>Note, these settings are stored in the project settings and therefore apply to all designs in the project.</p>`,e,"Cancel","Save",null,async function(e){t.external_source_url&&(t.external_source_url=a.getRelativeUrl(t.external_source_url)),t.external_config_url&&(t.external_config_url=a.getRelativeUrl(t.external_config_url)),i===e.mode||"external"!==i&&"external"!==e.mode?(r.setSettings(e),pgDmStore.update()):(r.setSettings(e,!0),r.recreateEngine(function(){"external"===i&&pinegrow.getAllPages().forEach(function(t){r.getEngine(function(e){e.activateOnPage(t)})}),pgDmStore.update()}),"external"===e.mode&&pinegrow.showAlert(`<p>Please make sure that the externally compiled Tailwind CSS stylesheet is included on HTML pages in this project. If the built-in compiler was used before, you will also have to remove any references to <code>tailwind_theme/tailwind.css</code> from the page.</p><p>The easiest way to add the stylesheet is to drag it from the Project panel to the page view.</p><p>To remove the old stylesheet from the page, delete its style node in the Tree panel.</p>`,"Add the Tailwind CSS stylesheet to the page, if needed",null,"Got it")),await r.framework.twLoadTailwindForCurrentVersion(null,!0),r.framework.twc&&(r.framework.twc.setScreensFromConfigValues(r.getScreenSizes()),$("body").trigger("crsa-breakpoints-changed"),pinegrow.selectedElements.reselect(),"external"===e.mode)&&r.framework.twc.requestUpdateFromJIT()})},(isApp()||1)&&this.addControl("button.options",{type:"button",name:"Compiler &amp; custom config...",func:function(){t.openDialog()},helptext:"Select between built-in and external Tailwind CSS compiler and edit custom configuration for internal compiler."})}populateDefaultParams(){this.setParam("disable.preflight","0",!0)}}class PgDmDesignSkillColorsForTailwind extends PgDmDesignSkillColors{constructor(e){super("tw.colors",e,function(){return""})}onGetConfigObject(e,s){function n(e){return"string"==typeof e&&e.startsWith("ok")?e:chroma(e).hex()}"init"===e&&(s.theme=s.theme||{},s.theme.extend=s.theme.extend||{},s.theme.extend.colors=s.theme.extend.colors||{},this.colors.forEachColor(function(e,t,i){try{var o;i.hasShades()?(o={},i.forEachShade(function(e,t){o[e]=n(t)}),s.theme.extend.colors[e]=o):s.theme.extend.colors[e]=n(t)}catch(e){}}))}populateDefaultParams(e){e||this.colors.clear(),4<=pgDmStore.getActiveDesignProvider().getTailwindVersion()?(this.colors.add("red","oklch(0.637 0.237 25.331)",!0,{50:"oklch(0.971 0.013 17.38)",100:"oklch(0.936 0.032 17.717)",200:"oklch(0.885 0.062 18.334)",300:"oklch(0.808 0.114 19.571)",400:"oklch(0.704 0.191 22.216)",500:"oklch(0.637 0.237 25.331)",600:"oklch(0.577 0.245 27.325)",700:"oklch(0.505 0.213 27.518)",800:"oklch(0.444 0.177 26.899)",900:"oklch(0.396 0.141 25.723)",950:"oklch(0.258 0.092 26.042)"},!0),this.colors.add("orange","oklch(0.705 0.213 47.604)",!0,{50:"oklch(0.98 0.016 73.684)",100:"oklch(0.954 0.038 75.164)",200:"oklch(0.901 0.076 70.697)",300:"oklch(0.837 0.128 66.29)",400:"oklch(0.75 0.183 55.934)",500:"oklch(0.705 0.213 47.604)",600:"oklch(0.646 0.222 41.116)",700:"oklch(0.553 0.195 38.402)",800:"oklch(0.47 0.157 37.304)",900:"oklch(0.408 0.123 38.172)",950:"oklch(0.266 0.079 36.259)"},!0),this.colors.add("amber","oklch(0.769 0.188 70.08)",!0,{50:"oklch(0.987 0.022 95.277)",100:"oklch(0.962 0.059 95.617)",200:"oklch(0.924 0.12 95.746)",300:"oklch(0.879 0.169 91.605)",400:"oklch(0.828 0.189 84.429)",500:"oklch(0.769 0.188 70.08)",600:"oklch(0.666 0.179 58.318)",700:"oklch(0.555 0.163 48.998)",800:"oklch(0.473 0.137 46.201)",900:"oklch(0.414 0.112 45.904)",950:"oklch(0.279 0.077 45.635)"},!0),this.colors.add("yellow","oklch(0.795 0.184 86.047)",!0,{50:"oklch(0.987 0.026 102.212)",100:"oklch(0.973 0.071 103.193)",200:"oklch(0.945 0.129 101.54)",300:"oklch(0.905 0.182 98.111)",400:"oklch(0.852 0.199 91.936)",500:"oklch(0.795 0.184 86.047)",600:"oklch(0.681 0.162 75.834)",700:"oklch(0.554 0.135 66.442)",800:"oklch(0.476 0.114 61.907)",900:"oklch(0.421 0.095 57.708)",950:"oklch(0.286 0.066 53.813)"},!0),this.colors.add("lime","oklch(0.768 0.233 130.85)",!0,{50:"oklch(0.986 0.031 120.757)",100:"oklch(0.967 0.067 122.328)",200:"oklch(0.938 0.127 124.321)",300:"oklch(0.897 0.196 126.665)",400:"oklch(0.841 0.238 128.85)",500:"oklch(0.768 0.233 130.85)",600:"oklch(0.648 0.2 131.684)",700:"oklch(0.532 0.157 131.589)",800:"oklch(0.453 0.124 130.933)",900:"oklch(0.405 0.101 131.063)",950:"oklch(0.274 0.072 132.109)"},!0),this.colors.add("green","oklch(0.723 0.219 149.579)",!0,{50:"oklch(0.982 0.018 155.826)",100:"oklch(0.962 0.044 156.743)",200:"oklch(0.925 0.084 155.995)",300:"oklch(0.871 0.15 154.449)",400:"oklch(0.792 0.209 151.711)",500:"oklch(0.723 0.219 149.579)",600:"oklch(0.627 0.194 149.214)",700:"oklch(0.527 0.154 150.069)",800:"oklch(0.448 0.119 151.328)",900:"oklch(0.393 0.095 152.535)",950:"oklch(0.266 0.065 152.934)"},!0),this.colors.add("emerald","oklch(0.696 0.17 162.48)",!0,{50:"oklch(0.979 0.021 166.113)",100:"oklch(0.95 0.052 163.051)",200:"oklch(0.905 0.093 164.15)",300:"oklch(0.845 0.143 164.978)",400:"oklch(0.765 0.177 163.223)",500:"oklch(0.696 0.17 162.48)",600:"oklch(0.596 0.145 163.225)",700:"oklch(0.508 0.118 165.612)",800:"oklch(0.432 0.095 166.913)",900:"oklch(0.378 0.077 168.94)",950:"oklch(0.262 0.051 172.552)"},!0),this.colors.add("teal","oklch(0.704 0.14 182.503)",!0,{50:"oklch(0.984 0.014 180.72)",100:"oklch(0.953 0.051 180.801)",200:"oklch(0.91 0.096 180.426)",300:"oklch(0.855 0.138 181.071)",400:"oklch(0.777 0.152 181.912)",500:"oklch(0.704 0.14 182.503)",600:"oklch(0.6 0.118 184.704)",700:"oklch(0.511 0.096 186.391)",800:"oklch(0.437 0.078 188.216)",900:"oklch(0.386 0.063 188.416)",950:"oklch(0.277 0.046 192.524)"},!0),this.colors.add("cyan","oklch(0.715 0.143 215.221)",!0,{50:"oklch(0.984 0.019 200.873)",100:"oklch(0.956 0.045 203.388)",200:"oklch(0.917 0.08 205.041)",300:"oklch(0.865 0.127 207.078)",400:"oklch(0.789 0.154 211.53)",500:"oklch(0.715 0.143 215.221)",600:"oklch(0.609 0.126 221.723)",700:"oklch(0.52 0.105 223.128)",800:"oklch(0.45 0.085 224.283)",900:"oklch(0.398 0.07 227.392)",950:"oklch(0.302 0.056 229.695)"},!0),this.colors.add("sky","oklch(0.685 0.169 237.323)",!0,{50:"oklch(0.977 0.013 236.62)",100:"oklch(0.951 0.026 236.824)",200:"oklch(0.901 0.058 230.902)",300:"oklch(0.828 0.111 230.318)",400:"oklch(0.746 0.16 232.661)",500:"oklch(0.685 0.169 237.323)",600:"oklch(0.588 0.158 241.966)",700:"oklch(0.5 0.134 242.749)",800:"oklch(0.443 0.11 240.79)",900:"oklch(0.391 0.09 240.876)",950:"oklch(0.293 0.066 243.157)"},!0),this.colors.add("blue","oklch(0.623 0.214 259.815)",!0,{50:"oklch(0.97 0.014 254.604)",100:"oklch(0.932 0.032 255.585)",200:"oklch(0.882 0.059 254.128)",300:"oklch(0.809 0.105 251.813)",400:"oklch(0.707 0.165 254.624)",500:"oklch(0.623 0.214 259.815)",600:"oklch(0.546 0.245 262.881)",700:"oklch(0.488 0.243 264.376)",800:"oklch(0.424 0.199 265.638)",900:"oklch(0.379 0.146 265.522)",950:"oklch(0.282 0.091 267.935)"},!0),this.colors.add("indigo","oklch(0.585 0.233 277.117)",!0,{50:"oklch(0.962 0.018 272.314)",100:"oklch(0.93 0.034 272.788)",200:"oklch(0.87 0.065 274.039)",300:"oklch(0.785 0.115 274.713)",400:"oklch(0.673 0.182 276.935)",500:"oklch(0.585 0.233 277.117)",600:"oklch(0.511 0.262 276.966)",700:"oklch(0.457 0.24 277.023)",800:"oklch(0.398 0.195 277.366)",900:"oklch(0.359 0.144 278.697)",950:"oklch(0.257 0.09 281.288)"},!0),this.colors.add("violet","oklch(0.606 0.25 292.717)",!0,{50:"oklch(0.969 0.016 293.756)",100:"oklch(0.943 0.029 294.588)",200:"oklch(0.894 0.057 293.283)",300:"oklch(0.811 0.111 293.571)",400:"oklch(0.702 0.183 293.541)",500:"oklch(0.606 0.25 292.717)",600:"oklch(0.541 0.281 293.009)",700:"oklch(0.491 0.27 292.581)",800:"oklch(0.432 0.232 292.759)",900:"oklch(0.38 0.189 293.745)",950:"oklch(0.283 0.141 291.089)"},!0),this.colors.add("purple","oklch(0.627 0.265 303.9)",!0,{50:"oklch(0.977 0.014 308.299)",100:"oklch(0.946 0.033 307.174)",200:"oklch(0.902 0.063 306.703)",300:"oklch(0.827 0.119 306.383)",400:"oklch(0.714 0.203 305.504)",500:"oklch(0.627 0.265 303.9)",600:"oklch(0.558 0.288 302.321)",700:"oklch(0.496 0.265 301.924)",800:"oklch(0.438 0.218 303.724)",900:"oklch(0.381 0.176 304.987)",950:"oklch(0.291 0.149 302.717)"},!0),this.colors.add("fuchsia","oklch(0.667 0.295 322.15)",!0,{50:"oklch(0.977 0.017 320.058)",100:"oklch(0.952 0.037 318.852)",200:"oklch(0.903 0.076 319.62)",300:"oklch(0.833 0.145 321.434)",400:"oklch(0.74 0.238 322.16)",500:"oklch(0.667 0.295 322.15)",600:"oklch(0.591 0.293 322.896)",700:"oklch(0.518 0.253 323.949)",800:"oklch(0.452 0.211 324.591)",900:"oklch(0.401 0.17 325.612)",950:"oklch(0.293 0.136 325.661)"},!0),this.colors.add("pink","oklch(0.656 0.241 354.308)",!0,{50:"oklch(0.971 0.014 343.198)",100:"oklch(0.948 0.028 342.258)",200:"oklch(0.899 0.061 343.231)",300:"oklch(0.823 0.12 346.018)",400:"oklch(0.718 0.202 349.761)",500:"oklch(0.656 0.241 354.308)",600:"oklch(0.592 0.249 0.584)",700:"oklch(0.525 0.223 3.958)",800:"oklch(0.459 0.187 3.815)",900:"oklch(0.408 0.153 2.432)",950:"oklch(0.284 0.109 3.907)"},!0),this.colors.add("rose","oklch(0.645 0.246 16.439)",!0,{50:"oklch(0.969 0.015 12.422)",100:"oklch(0.941 0.03 12.58)",200:"oklch(0.892 0.058 10.001)",300:"oklch(0.81 0.117 11.638)",400:"oklch(0.712 0.194 13.428)",500:"oklch(0.645 0.246 16.439)",600:"oklch(0.586 0.253 17.585)",700:"oklch(0.514 0.222 16.935)",800:"oklch(0.455 0.188 13.697)",900:"oklch(0.41 0.159 10.272)",950:"oklch(0.271 0.105 12.094)"},!0),this.colors.add("slate","oklch(0.554 0.046 257.417)",!0,{50:"oklch(0.984 0.003 247.858)",100:"oklch(0.968 0.007 247.896)",200:"oklch(0.929 0.013 255.508)",300:"oklch(0.869 0.022 252.894)",400:"oklch(0.704 0.04 256.788)",500:"oklch(0.554 0.046 257.417)",600:"oklch(0.446 0.043 257.281)",700:"oklch(0.372 0.044 257.287)",800:"oklch(0.279 0.041 260.031)",900:"oklch(0.208 0.042 265.755)",950:"oklch(0.129 0.042 264.695)"},!0),this.colors.add("gray","oklch(0.551 0.027 264.364)",!0,{50:"oklch(0.985 0.002 247.839)",100:"oklch(0.967 0.003 264.542)",200:"oklch(0.928 0.006 264.531)",300:"oklch(0.872 0.01 258.338)",400:"oklch(0.707 0.022 261.325)",500:"oklch(0.551 0.027 264.364)",600:"oklch(0.446 0.03 256.802)",700:"oklch(0.373 0.034 259.733)",800:"oklch(0.278 0.033 256.848)",900:"oklch(0.21 0.034 264.665)",950:"oklch(0.13 0.028 261.692)"},!0),this.colors.add("zinc","oklch(0.552 0.016 285.938)",!0,{50:"oklch(0.985 0 0)",100:"oklch(0.967 0.001 286.375)",200:"oklch(0.92 0.004 286.32)",300:"oklch(0.871 0.006 286.286)",400:"oklch(0.705 0.015 286.067)",500:"oklch(0.552 0.016 285.938)",600:"oklch(0.442 0.017 285.786)",700:"oklch(0.37 0.013 285.805)",800:"oklch(0.274 0.006 286.033)",900:"oklch(0.21 0.006 285.885)",950:"oklch(0.141 0.005 285.823)"},!0),this.colors.add("neutral","oklch(0.556 0 0)",!0,{50:"oklch(0.985 0 0)",100:"oklch(0.97 0 0)",200:"oklch(0.922 0 0)",300:"oklch(0.87 0 0)",400:"oklch(0.708 0 0)",500:"oklch(0.556 0 0)",600:"oklch(0.439 0 0)",700:"oklch(0.371 0 0)",800:"oklch(0.269 0 0)",900:"oklch(0.205 0 0)",950:"oklch(0.145 0 0)"},!0),this.colors.add("stone","oklch(0.553 0.013 58.071)",!0,{50:"oklch(0.985 0.001 106.423)",100:"oklch(0.97 0.001 106.424)",200:"oklch(0.923 0.003 48.717)",300:"oklch(0.869 0.005 56.366)",400:"oklch(0.709 0.01 56.259)",500:"oklch(0.553 0.013 58.071)",600:"oklch(0.444 0.011 73.639)",700:"oklch(0.374 0.01 67.558)",800:"oklch(0.268 0.007 34.298)",900:"oklch(0.216 0.006 56.043)",950:"oklch(0.147 0.004 49.25)"},!0)):(this.colors.add("gray","rgba(107,114,128,1)",!0,{50:"rgba(249,250,251,1)",100:"rgba(243,244,246,1)",200:"rgba(229,231,235,1)",300:"rgba(209,213,219,1)",400:"rgba(156,163,175,1)",500:"rgba(107,114,128,1)",600:"rgba(75,85,99,1)",700:"rgba(55,65,81,1)",800:"rgba(31,41,55,1)",900:"rgba(17,24,39,1)"},!0),this.colors.add("red","rgba(239,68,68,1)",!0,{50:"rgba(254,242,242,1)",100:"rgba(254,226,226,1)",200:"rgba(254,202,202,1)",300:"rgba(252,165,165,1)",400:"rgba(248,113,113,1)",500:"rgba(239,68,68,1)",600:"rgba(220,38,38,1)",700:"rgba(185,28,28,1)",800:"rgba(153,27,27,1)",900:"rgba(127,29,29,1)"},!0),this.colors.add("yellow","rgba(245,158,11,1)",!0,{50:"rgba(255,251,235,1)",100:"rgba(254,243,199,1)",200:"rgba(253,230,138,1)",300:"rgba(252,211,77,1)",400:"rgba(251,191,36,1)",500:"rgba(245,158,11,1)",600:"rgba(217,119,6,1)",700:"rgba(180,83,9,1)",800:"rgba(146,64,14,1)",900:"rgba(120,53,15,1)"},!0),this.colors.add("green","rgba(16,185,129,1)",!0,{50:"rgba(236,253,245,1)",100:"rgba(209,250,229,1)",200:"rgba(167,243,208,1)",300:"rgba(110,231,183,1)",400:"rgba(52,211,153,1)",500:"rgba(16,185,129,1)",600:"rgba(5,150,105,1)",700:"rgba(4,120,87,1)",800:"rgba(6,95,70,1)",900:"rgba(6,78,59,1)"},!0),this.colors.add("blue","rgba(59,130,246,1)",!0,{50:"rgba(239,246,255,1)",100:"rgba(219,234,254,1)",200:"rgba(191,219,254,1)",300:"rgba(147,197,253,1)",400:"rgba(96,165,250,1)",500:"rgba(59,130,246,1)",600:"rgba(37,99,235,1)",700:"rgba(29,78,216,1)",800:"rgba(30,64,175,1)",900:"rgba(30,58,138,1)"},!0),this.colors.add("indigo","rgba(99,102,241,1)",!0,{50:"rgba(238,242,255,1)",100:"rgba(224,231,255,1)",200:"rgba(199,210,254,1)",300:"rgba(165,180,252,1)",400:"rgba(129,140,248,1)",500:"rgba(99,102,241,1)",600:"rgba(79,70,229,1)",700:"rgba(67,56,202,1)",800:"rgba(55,48,163,1)",900:"rgba(49,46,129,1)"},!0),this.colors.add("purple","rgba(139,92,246,1)",!0,{50:"rgba(245,243,255,1)",100:"rgba(237,233,254,1)",200:"rgba(221,214,254,1)",300:"rgba(196,181,253,1)",400:"rgba(167,139,250,1)",500:"rgba(139,92,246,1)",600:"rgba(124,58,237,1)",700:"rgba(109,40,217,1)",800:"rgba(91,33,182,1)",900:"rgba(76,29,149,1)"},!0),this.colors.add("pink","rgba(236,72,153,1)",!0,{50:"rgba(253,242,248,1)",100:"rgba(252,231,243,1)",200:"rgba(251,207,232,1)",300:"rgba(249,168,212,1)",400:"rgba(244,114,182,1)",500:"rgba(236,72,153,1)",600:"rgba(219,39,119,1)",700:"rgba(190,24,93,1)",800:"rgba(157,23,77,1)",900:"rgba(131,24,67,1)"},!0)),super.populateDefaultParams()}}class PgDmDesignProviderForTailwind extends PgDmDesignProvider{constructor(e){super("tw","Tailwind CSS Design"),this.framework=e;var i=this;this.delayed_tasks=new PgDelayedTasks,this.on_engine_ready_funcs=[],this.colors=new PgDmDesignColors,this.colors.can_edit=!0,this.colors.mode="class",this.colors.default_shades=["50","100","200","300","400","500","600","700","800","900","950"],this.setDefaultSettings(),this.addSkills(),pinegrow.addEventHandler("on_tw_default_theme_loaded",function(e,t){t.setScreensFromConfigValues(i.getScreenSizes())})}useExternalBuild(){return isApp()&&"external"===this.settings.mode}useTailwindJIT(){return this.settings.mode.startsWith("jit")}disablePreflight(){return"1"===this.settings?.disable_preflight}validateCustomConfig(e,t){var i=4<=this.getTailwindVersion();if(e)if(i)try{var o=new PgTailwind4ConfigParser;o.parse(e),t&&(t.parser=o)}catch(e){return`This is not a valid Tailwind CSS 4 config. `+e}else try{JSON.parse(e)}catch(e){return"This is not a valid JSON. Check brackets and quotes."}}getScreenSizes(e){var t,i={sm:"640px",md:"768px",lg:"1024px",xl:"1280px","2xl":"1536px"},o=(this.framework.twc.has_data()&&(i=this.framework.twc.getScreensObjectWithSizes()),{});if(this.settings.custom_config)try{t=JSON.parse(this.settings.custom_config),0&&t.theme&&($.each(t.theme,function(e,t){"extend"!==e&&(o[e]=Object.keys(t))}),t.theme.extend)&&$.each(t.theme.extend,function(t,e){t in o||(o[t]=[]),Object.keys(e).forEach(function(e){o[t].indexOf(e)<0&&o[t].push(e)})}),t?.theme?.screens&&(i=t.theme.screens),t?.theme?.extend?.screens&&(i={...i,...t.theme.extend.screens})}catch(e){}return e&&(e.values=o,e.screens=i),i}getCustomConfig(){var e={};if(this.getTailwindVersion()<4&&this.settings.custom_config)try{e=JSON.parse(this.settings.custom_config)}catch(e){pinegrow.showQuickError("Custom Tailwind CSS config is not a valid JSON.")}return e}getTailwindVersion(){switch(this.settings.mode){case"jit4":return 4;case"jit":return 3;case"jit2":case"full":return 2.2;case"external":return pinegrow.getCurrentProject().twUseExternalBuildVersion||3;default:return 3}}activate(){super.activate(),this.delayed_tasks.clearAll(),this.onCustomTailwindCSSChanged_bind=this.onCustomTailwindCSSChanged.bind(this),pinegrow.addEventHandler("on_only_code_page_changed",this.onCustomTailwindCSSChanged_bind)}deactivate(){super.deactivate(),pinegrow.removeEventHandler("on_only_code_page_changed",this.onCustomTailwindCSSChanged_bind),this.delayed_tasks.clearAll()}onCustomTailwindCSSChanged(e){var t=pinegrow.getCurrentProject();t&&t.getRelativeUrl(e.url)===this.settings?.custom_source_url&&this.delayed_tasks.run("update",function(){pgDmStore.update()},1e3)}firstActivateInProject(e){var t=this;let i="jit";4<=this.framework.twGetTWVersionForPage(pinegrow.getSelectedPage())&&(i="jit4"),t.default_compiler=i,t.setDefaultSettings(),pinegrow.getCurrentProject().findFilesByName("tailwind.config.js").length?pinegrow.showAlert(`<p>The project contains the <code>tailwind.config.js</code> file. If you are using an existing Tailwind CSS build process outside of Pinegrow, you can keep using it with the Design panel, after making <a href="https://pinegrow.com/docs/tailwind/using-external-build-process/" class="external">a couple of simple changes</a>.</p><p>Which Tailwind CSS compiler would you like to use?</p>
<ul>
<li>The built-in compiler (the simplest option), or</li>
<li>The external compiler (the most flexible option, if you are already compiling Tailwind CSS outside Pinegrow).</li>
</ul>
`,"Would you like to use the external build process?","Cancel","Use the built-in compiler",null,function(){e&&e()},"Use the external compiler",function(){t.default_compiler="external",t.setDefaultSettings(),t.setSettings(t.settings,!0),t.notifyAboutMissingSource(),e&&e()}):e&&e()}notifyAboutMissingSource(){this.getTailwindVersion()<4&&pinegrow.showAlert(`<p>Source CSS file and config file for the external Tailwind CSS build process need to be selected. Please open Tailwind CSS Compiler options and update the information.</p>`,"Tailwind CSS config is not set","Cancel","Open Tailwind CSS options...",null,function(){var e=pgDmStore.getDesignSkill("tailwind");e&&e.openDialog()})}onProjectLoaded(e){super.onProjectLoaded(e),this.default_compiler="jit"}onActivated(){super.onActivated();const e=this;this.useExternalBuild()&&(new PgExternalTailwindVersionDetector).detect(!0),setTimeout(function(){e.options_skill.node&&"1"===e.options_skill.node.getAttribute("disable.preflight")&&!e.settings.ignore_skill_preflight_setting&&(e.setSettings({disable_preflight:"1",ignore_skill_preflight_setting:"1"}),pgDmStore.update(),pinegrow.showAlert(`<p>The option to disable preflight (a collection of CSS rules that reset all default browser styling) has been moved to the Compiler &amp; custom config dialog. Preflight is disabled for this project.</p>`,"Preflight is disabled",null,"Got it"))},1e3)}setDefaultSettings(){this.settings={mode:this.default_compiler||"jit",external_source_url:null}}activatedOnPage(e){this.class_tracker.enable(),this.class_tracker.inspectPage(e)}addSkills(){var e=new PgDmDesignSkillColorsForTailwind(this.colors);this.addSkill(e),this.fonts_skill=new PgDmTailwindFontsSkill,this.addSkill(this.fonts_skill),this.bck_skill=new PgDmDesignSkillBackground(e,"TW"),this.bck_skill.onGetBackgroundColorCSS=function(e){return e?`body { @apply bg-${e}; }
`:""},this.bck_skill.onGetConfigObject=function(e,i){var t;"init"===e&&(i.theme=i.theme||{},i.theme.extend=i.theme.extend||{},i.theme.extend.backgroundImage=i.theme.extend.backgroundImage||{},t=this.getBackgroundImagesAsObject(),$.each(t,function(e,t){i.theme.extend.backgroundImage[e]=t}))},this.addSkill(this.bck_skill),this.options_skill=new PgDmDesignSkillTailwindOptions(2,this),this.addSkill(this.options_skill)}getActiveFonts(){return this.fonts_skill.getActiveFonts()}canEditColors(){return!0}supportsColorShades(){return!0}getEngine(e){var i=this;this.engine?this.engine.isReady()?e(this.engine):i.on_engine_ready_funcs.push(e):this.engine=new PgDmTailwindEngine(function(t){i.on_engine_ready_funcs.forEach(function(e){e(t)}),i.on_engine_ready_funcs=[],e&&e(t)},this)}async withEngine(){const e=this;return new Promise(function(t){e.getEngine(function(e){t(e)})})}onClassesChanged(){this.framework&&this.framework.twIsUsingExternalBuild()||this.getEngine(function(e){e.jit&&e.update()})}hasOnlyDefaultColors(){return!this.colors.getColorObject("primary")}hasColor(e){return this.colors.getColorObject(e)}onBeforeSurpriseMe(e){var t=this,i=pinegrow.getCurrentProject();0===this.colors.getNumberOfUnlockedColors()&&this.hasOnlyDefaultColors()&&!i.twAskedAboutColors?(i.twAskedAboutColors=!0,pinegrow.showAlert(`<p>Default Tailwind CSS colors are locked by default because it makes no sense to change Red into blue, for example.</p><p>You can either unlock some of the default colors, or you can add additional colors and use them with Surprise Me. Such colors should have names like <code>primary</code>, <code>secondary</code>, <code>color3</code> and <code>color4</code> (you can rename the colors at any time).</p><p>Would you like to add these additional colors now and use them with Surprise Me?</p>`,"All colors are locked",`No, don't change colors`,`Yes, add colors`,e,function(){t.addCustomizableColors(),e()})):e()}onGetDesignThumbHTML(e,t){t.fonts=this.fonts_skill.getDesignThumbHTML(e)}addCustomizableColors(){this.colors.add("primary","rgba(107,114,128,1)",!1,{50:"rgba(249,250,251,1)",100:"rgba(243,244,246,1)",200:"rgba(229,231,235,1)",300:"rgba(209,213,219,1)",400:"rgba(156,163,175,1)",500:"rgba(107,114,128,1)",600:"rgba(75,85,99,1)",700:"rgba(55,65,81,1)",800:"rgba(31,41,55,1)",900:"rgba(17,24,39,1)",950:"rgba(17,24,39,1)"},!0),this.colors.add("secondary","rgba(107,114,128,1)",!1,{50:"rgba(249,250,251,1)",100:"rgba(243,244,246,1)",200:"rgba(229,231,235,1)",300:"rgba(209,213,219,1)",400:"rgba(156,163,175,1)",500:"rgba(107,114,128,1)",600:"rgba(75,85,99,1)",700:"rgba(55,65,81,1)",800:"rgba(31,41,55,1)",900:"rgba(17,24,39,1)",950:"rgba(17,24,39,1)"},!0),this.colors.add("color3","rgba(107,114,128,1)",!1,{50:"rgba(249,250,251,1)",100:"rgba(243,244,246,1)",200:"rgba(229,231,235,1)",300:"rgba(209,213,219,1)",400:"rgba(156,163,175,1)",500:"rgba(107,114,128,1)",600:"rgba(75,85,99,1)",700:"rgba(55,65,81,1)",800:"rgba(31,41,55,1)",900:"rgba(17,24,39,1)",950:"rgba(17,24,39,1)"},!0),this.colors.add("color4","rgba(107,114,128,1)",!1,{50:"rgba(249,250,251,1)",100:"rgba(243,244,246,1)",200:"rgba(229,231,235,1)",300:"rgba(209,213,219,1)",400:"rgba(156,163,175,1)",500:"rgba(107,114,128,1)",600:"rgba(75,85,99,1)",700:"rgba(55,65,81,1)",800:"rgba(31,41,55,1)",900:"rgba(17,24,39,1)",950:"rgba(17,24,39,1)"},!0)}getFontsOptions(e){return this.fonts_skill.getFontsOptions(e)}getBackgroundImageOptions(){var i=[],e=this.bck_skill.getBackgroundImagesAsObject();return $.each(e,function(e,t){i.push({key:"bg-"+e,name:e})}),i}getColorOptions(e){for(var t=this.getColorsForPicker(e),i=[],o=0;o<t.length;o++)for(var s=t[o],n=0;n<s.length;n++)i.push(s[n]);return i}getColorsForPicker(e){return this.colors.getColorsForPicker(e,[[{key:e+"current",name:"current",color:"white",text:"c"},{key:e+"transparent",name:"transparent",color:"rgba(0,0,0,0)"},{key:e+"black",name:"black",color:"black"},{key:e+"white",name:"white",color:"white"},{key:e+"inherit",name:"inherit",color:"rgba(0,0,0,0.5)"}]])}destroyEngine(){this.engine&&this.engine.destroy(),this.engine=null}recreateEngine(e){this.destroyEngine(),this.getEngine(e,this)}}class PgDmTailwindFontsSkill extends PgDmDesignSkill{constructor(){super("fonts","Fonts"),this.fixed=["sans","serif"],this.max_num=10;for(var r=this,e=new PgToggleButtonMaker,t=1;t<=this.max_num;t++){var i=t<=this.fixed.length?this.fixed[t-1]:null;this.addControl(`name_`+t,{name:"Name",type:i?"hidden":"text",default_value:i,start_repeat_item:i||`Custom font `+(t-this.fixed.length),tw_repeat_item_index:t,repeat_item_open:null!==i,add_repeat_item_label:"Add font family",on_create_repeat_item_button:function(e){$(`<button class="pg-button" style="margin-left:4px;height: 27px;vertical-align: top;">Manage fonts...</button>`).appendTo(e).on("click",function(e){e.preventDefault(),pinegrow.fontLibrary.showLibrary()})},dm_no_lock:"placeholder",on_repeat_item_removed:function(e,t,n){t.removeClass("has-value"),pinegrow.requireProjectDB(function(e){e.startBatchUpdates();var t=n.tw_repeat_item_index;r.setParam(`family_`+t,""),r.setParam(`name_`+t,"");for(var i=t+1;i<=r.max_num;i++){var o=r.getParam(`name_`+i),s=r.getParam(`family_`+i);(o||s)&&(r.setParam(`family_`+(i-1),s),r.setParam(`name_`+(i-1),o),r.setParam(`family_`+i,""),r.setParam(`name_`+i,""))}e.endBatchUpdates("Remove font family","design_panel"),pgDmStore.update()})}}),this.addControl(`family_`+t,{name:"Family",type:"select",show_empty:!0,fill_list_on_open:!0,can_add_items:!0,options:function(){return pinegrow.fontLibrary.getSelectOptions()}}),r.addControl(t+`_options_container`,{name:"Use for",type:"displayhtmlwithlabel",html:"",class:`crsa-field-text-font-options-container crsa-field-text-font-options-container-`+t,dm_no_lock:"placeholder"});for(var o=1;o<=6;o++)r.addControl(`h${o}_`+t,{name:"H"+o,type:"select",toggle_buttons:!0,append_to:`.crsa-field-text-font-options-container-`+t,without_text:!0,show_empty:!0,dm_no_lock:!0,options:[{key:"h"+o,name:"H"+o,html:e.makeText("H"+o,{attributes:{title:"Use for H"+o},styles:{padding:"4px 0"}})}]})}}getFontsOptions(e){var t=[],i=!1;for(let n=1;n<=this.max_num;n++){var o=n<=this.fixed.length?this.fixed[n-1]:this.getParam(`name_`+n),s=this.getParam(`family_`+n);o&&(n<=this.fixed.length||s)&&(t.push({key:e+o,name:o}),"mono"===o)&&(i=!0)}return i||t.push({key:e+"mono",name:"mono"}),t}getActiveFonts(){var e=[];for(let o=1;o<=this.max_num;o++){var t=o<=this.fixed.length?this.fixed[o-1]:this.getParam(`name_`+o),i=this.getParam(`family_`+o);t&&i&&e.indexOf(i)<0&&e.push(i)}return e}getDesignThumbHTML(e){var t=e.findOne('dmdesignskill[skill="fonts"]'),i="",o=0;if(t)for(let e=1;e<=this.max_num;e++){var s=e<=this.fixed.length?this.fixed[e-1]:t.getAttribute(`name_`+e),n=t.getAttribute(`family_`+e);s&&n&&o<2&&(i+=`<p style="font-family: ${n.replace(/"/g,"'")};margin: 0px 0px;white-space: nowrap;">${n.replace(/["']/g,"")}</p>`,o++)}return i}onSurpriseMe(e){for(var t=1;t<=this.max_num;t++){var i=t<=this.fixed.length?this.fixed[t-1]:this.getParam(`name_`+t),o=`family_`+t;!this.isLocked(o)&&i&&(i="all",(this.getParam(`h1_`+t)||this.getParam(`h2_`+t))&&(i="h1"),i=pinegrow.fontLibrary.getRandomFont(i),this.setParam(o,i.family))}e()}onGetCSS(e,t){if("import"===e){var i=pgDmStore.design.fonts;i.clear();for(let e=1;e<=this.max_num;e++){var o=e<=this.fixed.length?this.fixed[e-1]:this.getParam(`name_`+e),s=this.getParam(`family_`+e);o&&s&&i.setFont({key:o,family:s})}var n=i.getImportStatements(t),n=n.length?n.join("\n")+"\n\n":"",r=i.getFontFontFaceStatements();return n+=r.length?r.join("\n\n")+"\n\n":""}if("rules"!==e)return"";var a="";for(let g=1;g<=this.max_num;g++){var l=g<=this.fixed.length?this.fixed[g-1]:this.getParam(`name_`+g),c=this.getParam(`family_`+g);if(l&&c){for(var h=[],d=1;d<=6;d++)this.getParam(`h${d}_`+g)&&h.push("h"+d);h.length&&(a+=`
${h.join(",")} {
    @apply font-${l};
}                    
`)}}return a}onGetConfigObject(e,i){if("init"===e){i.theme=i.theme||{},i.theme.extend=i.theme.extend||{},i.theme.extend.fontFamily=i.theme.extend.fontFamily||{};for(let t=1;t<=this.max_num;t++){var o,s=t<=this.fixed.length?this.fixed[t-1]:this.getParam(`name_`+t);let e=this.getParam(`family_`+t);s&&e&&((o=pinegrow.fontLibrary.getFontByFamily(e))&&(e=o.getFamilyWithFallback()),i.theme.extend.fontFamily[s]=[e])}}}}class PgDmTailwindEngine extends PgDmEngine{constructor(e,t){super(e);var i=this,o=(this.design_provider=t,this.external_build=t.useExternalBuild(),this.jit=!0,this.is_ready=!1,this.done_list=[],this.class_cache={colors:"",fonts:"",backgrounds:""},this.delayedTasks=new PgDelayedTasks,this.twf=pinegrow.findFrameworkByKey("tw"),this.busy=!1,this.update_on_done=!1,pinegrow.getCurrentProject()),s=(this.custom_cs_url=null,this.showing_error=!1,this.validate_worker=null,this.validate_worker_busy=!1,this.validate_worker_queue=[],isApp()&&(this.fs=require("fs")),this.twf.twGetCurrentVersion()<4);this.external_build?(t.settings.external_source_url&&(t.settings.external_config_url||!s)||t.notifyAboutMissingSource(),this.is_ready=!0,setTimeout(function(){e&&e(i)},1)):(this.custom_cs_url=o.getAbsoluteUrl("tailwind_theme/tailwind.css"),(s=this.outcs=pinegrow.getStylesheetByUrl(this.custom_cs_url))?(i.is_ready=!0,e&&e(i)):((s=this.outcs=PgCSSStylesheet()).setUrl(this.custom_cs_url),pinegrow.stylesheets.addCrsaStylesheet(s),s.load(this.custom_cs_url,function(){i.is_ready=!0,e&&e(i)},!1,!0,!0)),s.usedByDesignPanel=!0)}getStylesheetUrl(){return this.custom_cs_url}getWorker(){var e=this.design_provider.getTailwindVersion();return 4<=e?(this.worker4||(this.worker4=PgTailwindCompilerV4.getInstance()),this.worker4):e<3?(this.worker2||(this.worker2=new Worker("frameworks/tailwindcss/resources/tailwind.compiler.v2.js")),this.worker2):(this.worker||(this.worker=new Worker("frameworks/tailwindcss/resources/tailwind.compiler.js")),this.worker)}activateOnPage(e,t){var i,o=this;!isApp()&&"_info.html"===e.name||(this.design_provider.activatedOnPage(e),this.external_build)?t&&t():(!e.sourceNode||(i=null,e.stylesheets.has(this.outcs))?t&&t():(e.sourceNode.withoutEvents(function(){e.sourceNode.find("link").forEach(function(e){var t;"stylesheet"===e.getAttribute("rel")&&(t=e.getAttribute("href"))&&t.match(/tailwind(\.min|)/i)&&(i=e)}),e.sourceNode.find("script").forEach(function(e){var t=e.getAttribute("src")||"";0<=t.indexOf("cdn.tailwindcss.com")&&e.remove(),0<=t.indexOf("@tailwindcss/browser@4")&&e.remove()}),o.outcs?e.stylesheets.attachTo(o.outcs,null,function(){pinegrow.changeManager.didChange(null,"Add generated stylesheet",null,e),$("body").trigger("crsa-stylesheets-changed"),e.refresh(),t&&t()},i):(pinegrow.showQuickError("Please reopen the project."),t&&t())}),e.setPageChanged(!0)),(1||e.tw_update_jit_on_activate)&&this.design_provider.useTailwindJIT()&&(e.tw_update_jit_on_activate=!1,this.update()))}getTailwindCS(e){return this.outcs}update(e){e&&this.done_list.push(e),this.delayedTasks.run("update",this.updateTask.bind(this),this.external_build?1:10)}getTailwindConfigAndCSS(){var e={css:"",config:this.design_provider.getCustomConfig(),cs_url:this.custom_cs_url};return e.config.mode=this.jit?"jit":"",e.config.customPlugins={typography:!0,forms:{active:!0},aspectRatio:!0},e.config.corePlugins={preflight:!0},pinegrow.dispatchEvent("on_dm_get_css",null,"import",e),pinegrow.dispatchEvent("on_dm_get_css",null,"init",e),e}updateTask(s){var n=this,r=pinegrow.getCurrentProject(),a=pinegrow.getSelectedPage();if(a)if(this.busy&&4e3<Date.now()-this.busy_time&&(this.busy=!1),this.busy)this.update_on_done=!0;else{var l=!1,e=pinegrow.findFrameworkByKey("wordpress.pinegrow"),e=(e&&(l=e.isWPEnabledForProject()),this.external_build=this.design_provider.useExternalBuild(),this.jit=this.design_provider.useTailwindJIT(),this.design_provider.getTailwindVersion()),e=4<=e,c=this.getTailwindConfigAndCSS(),t=(this.wp_css=null,c.css),i=(e?(k=this.design_provider.disablePreflight()?c.css+`
@layer theme, base, components, utilities;
@import "./theme.css" layer(theme) theme(static);
@import "./utilities.css" layer(utilities);        

@plugin "@tailwindcss/typography";      
@plugin "@tailwindcss/forms";  

@theme {
}
`:c.css+`
@import "tailwindcss" theme(static);

@plugin "@tailwindcss/typography";
@plugin "@tailwindcss/forms"; 

@theme {
}
`,l&&!this.design_provider.disablePreflight()&&(k=c.css+`
@layer theme, base, components, utilities;
@import "./theme.css" layer(theme) theme(static);
/* PREFLIGHT START */
@import "./preflight.css" layer(base);
/* PREFLIGHT END */
@import "./utilities.css" layer(utilities);    

@plugin "@tailwindcss/typography";  
@plugin "@tailwindcss/forms";          

@theme {
}
`)):(k=c.css+`
${this.design_provider.disablePreflight()?"":"@tailwind base;"}
@tailwind components;
@tailwind utilities;
`,l&&(k=c.css+`
/* PREFLIGHT START */${this.design_provider.disablePreflight()?"":"@tailwind base;"}/* PREFLIGHT END */
@tailwind components;
@tailwind utilities;
`)),c.css="",c.additional_classes="",pinegrow.dispatchEvent("on_dm_get_css",null,"rules",c),k+="\n"+c.css,this.design_provider.settings?.custom_source_url&&(i=r.getContentOfUrlWithLookup(this.design_provider.settings?.custom_source_url))&&(k+="\n"+i),!1),o=JSON.stringify(c.config.theme.extend.colors),h=JSON.stringify(c.config.theme.extend.fontFamily),d=JSON.stringify(c.config.theme.extend.backgroundImage);this.class_cache.colors===o&&this.class_cache.fonts===h&&this.class_cache.backgrounds===d||(i=!0,this.class_cache.colors=o,this.class_cache.fonts=h,this.class_cache.backgrounds=d);const v=[],y={};if(c.config?.theme?.extend?.colors&&$.each(c.config?.theme?.extend?.colors,function(i,e){"string"==typeof e?(v.push(`--color-${i}: ${e};`),y[`--color-`+i]=e):$.each(e,function(e,t){v.push(`--color-${i}-${e}: ${t};`),y[`--color-${i}-`+e]=t})}),c.config?.theme?.extend?.fontFamily&&$.each(c.config?.theme?.extend?.fontFamily,function(e,t){v.push(`--font-${e}: ${t};`),y[`--font-`+e]=t}),c.config?.theme?.extend?.screens&&$.each(c.config?.theme?.extend?.screens,function(e,t){v.push(`--breakpoint-${e}: ${t};`),y[`--breakpoint-`+e]=t}),c.config?.theme?.extend?.backgroundImage&&$.each(c.config?.theme?.extend?.backgroundImage,function(e,t){v.push(`--background-image-${e}: ${t};`),y[`--background-image-`+e]=t}),this.external_build){try{this.external_config_path=r.getAbsolutePath("tailwind.config.js"),this.external_source_file=crsaMakeFileFromUrl(r.getAbsoluteUrl(this.design_provider.settings.external_source_url)),e||(p=this.fs.readFileSync(this.external_config_path,{encoding:"utf8"}),u=`
const pg_colors = ${(g=new PgSimpleJsParser(p)).objToString(c.config.theme.extend.colors)}

const pg_fonts = ${g.objToString(c.config.theme.extend.fontFamily)}   

const pg_backgrounds = ${g.objToString(c.config.theme.extend.backgroundImage)}    
             
                `,p=pgUpdateGeneratedSectionContent(p,"Design Panel",u,"prepend"),this.fs.writeFileSync(this.external_config_path,p,{encoding:"utf8"}));var g,u,p,m,f,k=this.fs.readFileSync(this.external_source_file,{encoding:"utf8"}),_=(e&&(m="    "+v.join("\n    "),f={},k=pgUpdateGeneratedSectionContent(k,"Design Panel Theme",m,"none",f),f.done||pinegrow.showAlert(`<p>The marker for Design Panel CSS variables in <code>@theme</code> are missing.</p><p>Add the bolded code inside the <code>@theme {...}</code> declaration in file <code>${r.getRelativeUrl(this.external_source_file)}</code></p>:
<pre>
@theme {
...
<b style="font-weight: bold;">/* Pinegrow generated Design Panel Theme Begin */
/* Pinegrow generated Design Panel Theme End */</b>
}
</pre>
`,"Unable to update Tailwind CSS theme","Close")),k=pgUpdateGeneratedSectionContent(k,"Design Panel Init",t,"prepend"),k=pgUpdateGeneratedSectionContent(k,"Design Panel Extra Rules",c.css,"append"),this.fs.writeFileSync(this.external_source_file,k,{encoding:"utf8"}),pgDmStore.design.fonts.getFontUrls());n.addFontsToPageViews(function(){return pinegrow.getAllPages()},_)}catch(e){console.warn(`Unable to update tailwind.config.js and source file.`,e)}setTimeout(function(){n.update_on_done?n.update():(n.done_list.forEach(function(e){e()}),n.done_list=[]),n.busy=!1,n.update_on_done=!1},1)}else{if(e){const x=new PgTailwind4ConfigParser;if(x.parse(k),$.each(y,function(e,t){x.setThemeVariable(e,t)}),this.design_provider.settings.custom_config)try{const w=new PgTailwind4ConfigParser;w.parse(this.design_provider.settings.custom_config),$.each(w.getThemeVariables(),function(e,t){x.setThemeVariable(e,t,0<=e.indexOf("*")||"initial"===t)}),x.prependCode(w.getCodeBeforeTheme()),x.appendCode(w.getCodeAfterTheme())}catch(e){pinegrow.showQuickError(`Invalid custom Tailwind CSS configuration: `+e)}(k=x.getString()).match(/@theme static/m)||(k=k.replace("@theme","@theme static"))}var w=new CrsaProfile,b=(this.busy=!0,this.busy_time=Date.now(),function(e){n.showing_error||(n.showing_error=!0,pinegrow.showAlert(`<p>Tailwind CSS compilation failed due to error:</p><p><code style="white-space: normal;">${e.toString()}</code></p><p>Tailwind CSS code:</p><pre>${k}</pre>`,"Tailwind CSS error",null,"Ok",function(){n.showing_error=!1},function(){n.showing_error=!1}))}),o=(this.getWorker().onerror=function(e){console.error(e),n.busy=!1,n.update_on_done=!1,b(e)},this.getWorker().onmessage=function(e){var t,i,o;e.data.error?(console.error(e.data.error),n.busy=!1,n.update_on_done=!1,b(e.data.error),s&&s(null,e.data.error)):(w.show("Compiled TW JIT"),s?(s(e.data.css,null),n.busy=!1):(t=n.getTailwindCS(a))?(t.ignore_imports_in_apply=!0,l&&(o=`
*,::before,::after {
  box-sizing: border-box;
}

a {
          color: inherit;
          text-decoration: inherit;
        }
        ol,
        ul,
        menu {
          list-style: none;
          margin: 0;
          padding: 0;
        }
        
        blockquote,
        dl,
        dd,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        figure,
        p,
        pre {
          margin: 0;
        }                        
`,(i=c.config.theme?.extend?.fontFamily?.sans)&&(o+=`
html {
  font-family: ${i[0]};
}                      
`),i=e.data.css,e.data.css=e.data.css.replace("/* PREFLIGHT START */","").replace("/* PREFLIGHT END */",""),i=i.replace(/\/\* PREFLIGHT START \*\/([\s\S]*)\/\* PREFLIGHT END \*\//m,o),n.wp_css=i,isApp()||r.setContentOfUrlWithLookup("tailwind_theme/tailwind_for_wp_editor.css",i)),t.setSource(e.data.css,function(){w.show("TW JIT Applied to page"),n.busy=!1,n.update_on_done?n.update():(n.done_list.forEach(function(e){e()}),n.done_list=[]),n.update_on_done=!1,pinegrow.dispatchEvent("on_css_stylesheet_changed",null,t),pinegrow.selectedElements.repositionMenusDelayed(),pinegrow.refreshPageChangedStatusForAllPages(!0),pinegrow.dispatchEvent("on_tailwind_compiled")}),o=pgDmStore.design.fonts.getFontUrls(),n.addFontsToPageViews(t,o)):(n.busy=!1,n.update_on_done=!1))},this.twf.classTracker.getList()+" "+c.additional_classes);this.getWorker().postMessage({css:k,html:[`<html><body class="${o}"></body></html>`],config:c.config,vars:v}),i&&this.design_provider.onColorListChanged()}}else n.done_list.forEach(function(e){e()}),n.done_list=[]}async validateComponent(r,a){const l=this;return new Promise(function(o,s){function n(){l.validate_worker_busy=!1,l.validate_worker_queue.length&&l.validate_worker_queue.shift()()}function e(){var e=l.validate_worker||new Worker("frameworks/tailwindcss/resources/tailwind.compiler.js"),t=(l.validate_worker=e,l.getTailwindConfigAndCSS()),i=`@tailwind base;
@tailwind components;
@tailwind utilities;

@layer component {
${r} {
    @apply ${a.join(" ")};
}
}`;e.onerror=function(e){s(e),n()},e.onmessage=function(e){l.validate_worker_busy=!1,e.data.error?s(e.data.error):o(!0),n()},l.validate_worker_busy=!0,e.postMessage({css:i,html:[`<html><body class="grid"></body></html>`],config:t.config})}l.validate_worker_busy?l.validate_worker_queue.push(e):e()})}saveCSS(){var e,t=pinegrow.getSelectedPage(),t=this.getTailwindCS(t);t&&t.localFile&&(t.save(t.localFile),t.setChanged(!1)),this.wp_css&&(t=pinegrow.getCurrentProject().getAbsolutePath("tailwind_theme/tailwind_for_wp_editor.css"),e=!crsaIsFileExist(t),this.fs.writeFileSync(t,this.wp_css,{encoding:"utf8"}),e)&&pinegrow.refreshCurrentProjectDelayed(!0)}destroy(){this.worker&&this.worker.terminate(),this.worker=null,this.worker2&&this.worker2.terminate(),this.worker2=null,this.design_provider=null,this.delayedTasks.destroy(),this.outcs&&(this.outcs.usedByDesignPanel=!1,this.outcs.remove())}}class PgClassTracker{constructor(e){((this.design_provider=e).class_tracker=this).changed=!1,this.has_unsaved_changes=!1,this.list="",this.map={},this.profile=new CrsaProfile("Class Tracker"),this.profile.pause(),this.twf=null,this.handlers=[],this.is_enabled=!1,this.delayedTasks=new PgDelayedTasks,this.temp_classes=[];var r=this;pinegrow.addEventHandler("on_page_changes_done",function(e,t,i){var o,s=!1;(s=r.is_enabled&&(r.twf&&r.twf.twIsUsingExternalBuild()||pgDmStore.isDesignEnabled()&&(o=pgDmStore.getActiveDesignProvider())&&o.useTailwindJIT&&o.useTailwindJIT())?!0:s)&&(i&&r.inspectCollection(i),r.changed)&&(r.changed=!1,pgDmStore.isDesignEnabled())&&r.design_provider.onClassesChanged()}),pinegrow.addEventHandler("on_fast_dom_class_preview_start",function(e,t){r.temp_classes=[]}),pinegrow.addEventHandler("on_fast_dom_class_preview",function(e,t,i,o){var s,n;r.is_enabled&&(s=!1,(n=function(e){r.temp_classes.indexOf(e)<0&&!r.map[e]&&(r.temp_classes.push(e),s=!0)})(i),o&&o.forEach(function(e){n(e)}),s)&&(pgDmStore.isDesignEnabled()&&r.design_provider.onClassesChanged(),r.saveUsedClassesHtmlFileIfUsingExternalBuild())}),pinegrow.addEventHandler("on_fast_dom_class_preview_end",function(e,t){r.temp_classes=[]}),pinegrow.addEventHandler("on_project_loaded",function(e,t){r.twf=pinegrow.findFrameworkByKey("tw"),r.is_enabled=!1,r.reset(),r.temp_classes=[],r.load()&&(r.is_enabled=!0),r.twf&&r.twf.twIsUsingExternalBuild()&&(r.is_enabled=!0)}),pinegrow.addEventHandler("on_page_saved",function(e,t,i){r.is_enabled&&(i&&(r.inspectPage(e),r.changed)&&(e.tw_update_jit_on_activate=!0),r.has_unsaved_changes)&&r.save()}),pinegrow.addEventHandler("on_page_loaded",function(e){r.is_enabled&&(r.inspectPage(e),r.changed)&&(e.tw_update_jit_on_activate=!0,pgDmStore.isDesignEnabled())&&pgDmStore.update()}),pinegrow.addEventHandler("on_project_closed",function(e,t){isApp()&&r.is_enabled&&r.save(t),r.is_enabled=!1,r.temp_classes=[]}),pinegrow.addEventHandler("on_before_save_backend_project",function(e,t){r.has_unsaved_changes&&r.save()}),pinegrow.addEventHandler("on_project_scan_begin",function(e,t){r.useOnProject(t)&&r.reset()}),pinegrow.addEventHandler("on_project_scan_page",function(e,t,i){r.useOnProject(t)&&r.inspectPage(i)}),pinegrow.addEventHandler("on_project_scan_end",function(e,t){})}registerHandler(e){this.handlers.push(e)}unregisterHandler(e){var t=this.handlers.indexOf(e);0<=t&&this.handlers.splice(t,1)}getList(){return this.temp_classes.length?this.list+" "+this.temp_classes.join(" "):this.list}rescanProject(){var e=pinegrow.getCurrentProject();this.useOnProject(e)?e.forEachEditableFile(function(e,t,i){t(e,i)},function(){pinegrow.showQuickMessage("Done.")},"Looking for used classes in HTML files..."):pinegrow.showQuickError("Class tracking is not enabled on this project.")}enable(){this.is_enabled=!0}useOnProject(e){return this.is_enabled}inspect(e){this.profile.resume();function o(e){s.map[e]||(s.map[e]=!0,s.list+=" "+e,s.changed||(s.changed=!0),s.has_unsaved_changes=!0,0)}var s=this;e.walkSelfAndChildren(function(t){var i;return t.isElement&&(t.getClasses().forEach(o),s.handlers.length)&&(i=[],s.handlers.forEach(function(e){e(t,i)}),i.forEach(o)),!0}),this.changed&&this.saveUsedClassesHtmlFileIfUsingExternalBuild(),this.profile.pause(),this.profile.show("Total time")}saveUsedClassesHtmlFileIfUsingExternalBuild(){var t=this;this.twf&&this.twf.twIsUsingExternalBuild()&&this.delayedTasks.run("saveUsedClassesHtml",function(){var e=pinegrow.getCurrentProject().getAbsolutePath("_pginfo/used-classes.html");require("fs").writeFile(e,`<html><body><div class="${t.list} ${t.temp_classes.join(" ")}"></div></body></html>`,function(){})},5)}inspectCollection(e){var t=this;e.forEachElement(function(e){t.inspect(e)})}inspectPage(e){this.inspect(e.sourceNode)}inspectProject(e,t){var o=this,s=(this.reset(),t?100:0),i=pinegrow.getCurrentProject();i?i.forEachEditableFile(function(e,t,i){o.inspectPage(e),setTimeout(function(){t(e,i)},s)},function(){},"Looking for used classes...",null,null,t):(pinegrow.showQuickMessage("Looking for classes in all open pages..."),pinegrow.getAllPages().forEach(function(e){o.inspectPage(e)}),pinegrow.showQuickMessage("Done!"),e&&e())}reset(){this.changed=!1,this.has_unsaved_changes=!1,this.list="",this.map={}}delayedSave(){this.delayedTasks.run("save",this.save.bind(this),1e3)}save(e){var t=e?e.getProjectInfo():pinegrow.getCurrentProjectInfo();t&&(t.saveFile("class.tracker.json",JSON.stringify({list:this.list,map:this.map})),this.has_unsaved_changes=!1)}load(){var e=pinegrow.getCurrentProjectInfo();if(e){e=e.loadFile("class.tracker.json");if(e)try{var t=JSON.parse(e);return this.list=t.list,this.map=t.map,!0}catch(e){}}return!1}}class PgTailwindValidator{constructor(){this.reset()}reset(){this.classes={},this.selectors={}}isRegularTailwindClass(e){return this.twf||(this.twf=pinegrow.findFrameworkByKey("tw")),!!this.twf&&this.twf.twIsTailwindClass(e)}async getEngine(){var e=pgDmStore.getActiveDesignProvider();return e&&e instanceof PgDmDesignProviderForTailwind?e.withEngine():null}async validateClass(e){if(!this.classes[e]){if(!(pinegrow.classStyles.findStyleByKey("."+e)||e.indexOf(":")<0&&this.isRegularTailwindClass(e))){var t=pgDmStore.getActiveDesignProvider();if(t&&t instanceof PgDmDesignProviderForTailwind&&t.useExternalBuild())return!!this.isRegularTailwindClass(e)||`Class ${e} is not a valid Tailwind CSS class.`;t=await this.getEngine();if(t)try{await t.validateComponent(".dummy",[e])}catch(e){return e}}this.classes[e]=!0}return!0}async validateSelector(e){if(!this.selectors[e]){var t=await this.getEngine();if(t)try{await t.validateComponent(e,["grid"])}catch(e){return e}this.selectors[e]=!0}return!0}async validateVariant(e){return this.validateClass(e+":grid")}async validateClasses(e){for(var t={},i=0;i<e.length;i++)!0===await this.validateClass(e[i])?t[e[i]]=!0:t[e[i]]=!1;return t}}